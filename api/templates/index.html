<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    {% include 'partials/head.html' %}
    <title>Search</title>
</head>
<body>
{% include 'partials/navbar.html' %}

<div class="container-sm mt-5">
    <form id="imageSearchForm" onsubmit="imageSearchRequest()">
        <div class="input-group">
        <input type="text" class="form-control" placeholder="Add a tag then press comma or Enter" id="imageSearchTagInput">
        <button class="btn btn-outline-secondary" type="submit">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
            </svg>
        </button>
    </div>
    </form>
    <script>
        function imageSearchRequest(){
            let tags = document.getElementById('imageSearchTagInput').value;
            // on firefox prevents NS_BINDING_ERROR because submit button overwrite
            event.preventDefault()
            try {
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function() {
                    let images = JSON.parse(this.responseText);
                    if (images == NULL){
                        return;
                    }
                    images.forEach(function(value, index, array){
                        console.log(value)
                    })

                    const jsonString = JSON.stringify(item['imageMetadata'], null, 2);
                    const jsonDisplay = document.getElementById("jsonDisplay");
                    jsonDisplay.textContent = jsonString
                }
                xhttp.open("GET", "/search?labels=" + JSON.stringify(tags.split(",")));
                xhttp.send();
            } catch (error) {
                console.log("Fehler bei der Anfrage: " + error.message)
            }

        }

    </script>

    <div id="searchResults"></div>

    {% include 'partials/imageview.html' %}
</div>



{% include 'partials/footer.html' %}
    <script>
      const example = UseBootstrapTag(document.getElementById('imageSearchTagInput'))
    </script>
</body>
</html>
